<Project>
  <Target Name="PackAssetsIntoPak"
          BeforeTargets="MergeAllPaks"
          Inputs="@(PackAssets)"
          Outputs="$(IntermediateOutputPath)/_pack_assets.pak">
    <PropertyGroup>
      <PackedAssetsPakPath>$(IntermediateOutputPath)/_pack_assets.pak</PackedAssetsPakPath>
    </PropertyGroup>
    <Exec Command="$(_DCCM_Tools) pack-pak-with-files -o &quot;$(PackedAssetsPakPath)&quot; -i @(PackAssets->' &quot;%(FullPath)=%(RootInPak)/%(RecursiveDir)%(Filename)%(Extension)%&quot; ', ' ')"
          />

    <ItemGroup>
      <PakFile Include="$(PackedAssetsPakPath)" />
    </ItemGroup>
    
    
  </Target>

  <PropertyGroup>
    <OutputPakName Condition="'$(OutputPakName)' == ''">res.pak</OutputPakName>
  </PropertyGroup>

  <Target Name="MergeAllPaks"
          BeforeTargets="CopyOutputFiles"
          Inputs="@(PakFile)"
          Outputs="$(IntermediateOutputPath)/$(OutputPakName)">
    <PropertyGroup>
      <MergedPakPath>$(IntermediateOutputPath)/$(OutputPakName)</MergedPakPath>

    </PropertyGroup>

    <Exec Command="$(_DCCM_Tools) merge-paks -o &quot;$(MergedPakPath)&quot; -i @(PakFile->' &quot;%(FullPath)&quot; ', ' ')"
          />

    <ItemGroup>
      <OutputFiles Include="$(MergedPakPath)" />
    </ItemGroup>
  </Target>
</Project>